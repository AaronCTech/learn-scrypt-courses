# Chapter 12: OP_PUSH_TX

## Preimage

The preimage of the transaction is not the complete current transaction data, but the preimage generated by the complete current transaction. Bitcoin's signature is actually to sign the hash of the preimage of the transaction.

[Format](https://github.com/bitcoin-sv/bitcoin-sv/blob/master/doc/abc/replay-protected-sighash.md#digest-algorithm) The regulations are as followsï¼š

![](https://img-blog.csdnimg.cn/20200712222718698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZyZWVkb21oZXJv,size_16,color_FFFFFF,t_70#pic_center)

**OP_PUSH_TX** can be used to verify whether the SighashPreimage is the preimage of the current transaction.

sCrypt implements the **OP_PUSH_TX** algorithm and encapsulates it into the standard contract function `Tx.checkPreimage`, which is used to verify whether the incoming parameters are the preimage of the current transaction.

```solidity
contract OP_PUSH_TX {
    public function unlock(SigHashPreimage preimage) { 
        require(Tx.checkPreimage(preimage));
    }
}
```


## Put it to the Test

The `TicTacToe` contract is a stateful contract. The public function `move` is continuously called through the transaction to trigger the execution of the contract, thereby updating the state.
Therefore, **OP_PUSH_TX** technology must be used to maintain the state of the contract.

1. Check if the last parameter `txPreimage` of the `move` method is the preimage of the current transaction.

